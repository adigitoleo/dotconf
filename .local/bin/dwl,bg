#!/bin/sh
#set -euo pipefail
set -eu
readonly SCRIPTNAME="${0##*/}"
usage() { printf 'Usage: %s [-h]\n' "$SCRIPTNAME"; }
helpf() {
    echo 'Start custom background processes for wayland.'
    echo 'Call this using the autostart method for your compositor.'
    echo "For example, in dwl you can use dwl -s $SCRIPTNAME."
}

case "${1+_}" in
    "-h" | "--help" ) usage && helpf ; exit 0 ;;
esac

# NOTE: Do NOT start the ssh-agent from this script! Use `ssh-agent <compositor>` instead.
#       This will ensure that the agent dies with the compositor.

warn() { >&2 printf '%s\n' "${SCRIPTNAME}: $1"; }

is_command() { # Check if command exists, for flow control (no stdout messages)
    1>/dev/null 2>&1 command -v "$1" && [ "$?" -eq 0 ] && return 0 \
        || { warn "command '${1}' not found" && return 1 ;}
}
is_running() { # Check if an instance of a command is running using pgrep
     is_command pgrep && { 1>/dev/null 2>&1 pgrep "$1" && [ "$?" -eq 0 ] && return 0 ;}
}

is_running wlsunset || \
    {
        LOG="$(mktemp --tmpdir=/tmp $SCRIPTNAME-wlsunset-XXXXXX)"
        is_command wlsunset && wlsunset -l -35.3 -L 149.1 -t 4750 -T 6250 >"$LOG" 2>&1 ;
    } &
is_running swaybg || \
    {
        LOG="$(mktemp --tmpdir=/tmp $SCRIPTNAME-swaybg-XXXXXX)"
        is_command swaybg && swaybg -m fill -i "$HOME/Pictures/wallpapers/chauvet_lions_66292F.jpg" >"$LOG" 2>&1 ;
    } &
is_running mocp || \
    {
        LOG="$(mktemp --tmpdir=/tmp $SCRIPTNAME-mocp-XXXXXX)"
        is_command mocp && mocp -S >"$LOG" 2>&1 ;
    } &
