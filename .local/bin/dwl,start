#!/bin/sh
set -euo pipefail
SCRIPTNAME="${0##*/}"
SYNOPSIS="Usage: $SCRIPTNAME [-h]"
echoerr() { printf "$SCRIPTNAME: %s\n" "$*" >&2; echo $SYNOPSIS; }
echohelp() {
    echo
    echo 'Start dwl with an ssh-agent and other background processes.'
    echo 'The background processes are set in the `dwl,bg` script.'
    echo 'Use --noisy to show warnings/errors.'
}

case "${1+_}" in
    "-h" | "--help" ) echo $SYNOPSIS; echohelp; exit 0 ;;
    * ) DWL_OUTDIR="$HOME/.config/dwl"
        [ -d "$DWL_OUTDIR" ] || mkdir -p "$DWL_OUTDIR"
        LOG="$(mktemp --tmpdir=/tmp dwl-errors-XXXXXX)"
        ssh-agent dwl -s dwl,bg >"$DWL_OUTDIR/dwlbar" 2>>"$LOG"
        ;;
esac
