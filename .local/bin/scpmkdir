#!/bin/sh
readonly SCRIPTNAME="${0##*/}"
usage() {
    printf 'Usage: %s \n' "$SCRIPTNAME"
    printf '       %s ' "$SCRIPTNAME"
    echo 'source... target'
    echo
    echo 'Copy one or more sources to a remote target with scp,'
    echo 'creating the necessary directory tree.'
    echo 'See `man scp` for documentation of the operands.'
}
pop() {  # https://stackoverflow.com/a/63864756
    local n=$(($1 - ${2:-1}))
    if [ -n "$ZSH_VERSION" -o -n "$BASH_VERSION" ]; then
        POP_EXPR='set -- "${@:1:'$n'}"'
    elif [ $n -ge 500 ]; then
        POP_EXPR="set -- $(seq -s " " 1 $n | sed 's/[0-9]\+/"${\0}"/g')"
    else
        local index=0
        local arguments=""
        while [ $index -lt $n ]; do
            index=$((index+1))
            arguments="$arguments \"\${$index}\""
        done
        POP_EXPR="set -- $arguments"
    fi
}

[ $# -eq 0 ] && usage && exit 1
case "$1" in -* ) usage && exit 0 ;; esac
for TARGET; do : ; done
pop $#
eval "$POP_EXPR"
ssh "${TARGET%%:*}" "mkdir -p \$(realpath ${TARGET##*:})" && scp "$@" "$TARGET"
